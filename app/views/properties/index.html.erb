<!-- Main Layout Container -->
<div class="main-layout">
  <!-- Navigation Sidebar -->
  <div class="nav-sidebar">
    <div class="logo">
      <img src="https://placehold.co/50x50" alt="Logo" />
      <span>Bulsam AI</span>
    </div>
    
    <nav class="nav-menu">
      <%= link_to dashboard_path, class: "nav-item #{current_page?(dashboard_path) ? 'active' : ''}" do %>
        <i class="fas fa-th-large"></i>
        <span>Dashboard</span>
      <% end %>
      
      <%= link_to cars_path, class: "nav-item #{controller_name == 'cars' ? 'active' : ''}" do %>
        <i class="fas fa-car"></i>
        <span>Araç Takibi</span>
      <% end %>
      
      <%= link_to properties_path, class: "nav-item #{controller_name == 'properties' ? 'active' : ''}" do %>
        <i class="fas fa-home"></i>
        <span>Emlak Takibi</span>
      <% end %>
      
      <%= link_to notifications_path, class: "nav-item #{controller_name == 'notifications' ? 'active' : ''}", data: { turbo: false } do %>
        <i class="fas fa-bell"></i>
        <span>Bildirimler</span>
      <% end %>
      
      <a href="#" class="nav-item">
        <i class="fas fa-cog"></i>
        <span>Ayarlar</span>
      </a>
    </nav>
  </div>

  <!-- Main Content Area -->
  <div class="main-content" data-controller="popup">
    <div class="content-header">
      <div class="header-left">
        <h1>Emlak Takibi</h1>
        <p>Takip ettiğiniz emlakların listesi</p>
      </div>
      
      <div class="search-bar">
        <input type="text" placeholder="Emlak ara..." />
        <button class="search-btn"><i class="fas fa-search"></i></button>
        <button class="filter-btn"><i class="fas fa-filter"></i></button>
        <button class="btn-add-tracking" data-action="click->popup#open">
          <i class="fas fa-plus"></i>
          Yeni Emlak Takibi Ekle
        </button>
      </div>
    </div>

    <!-- Tracked Properties List -->
    <div class="tracked-items">
      <% if @property_scrapes.any? %>
        <% @property_scrapes.each do |scrape| %>
          <div class="tracked-item">
            <div class="item-image">
              <img src="https://placehold.co/200x150" alt="<%= scrape.title %>" />
            </div>
            <div class="item-details">
              <div class="item-header">
                <h3><%= scrape.title %></h3>
                <div class="price">₺<%= number_with_delimiter(scrape.price.to_i) %></div>
              </div>
              <div class="item-specs">
                <span><i class="fas fa-ruler-combined"></i> <%= scrape.size %> m²</span>
                <span><i class="fas fa-door-open"></i> <%= scrape.rooms %></span>
                <span><i class="fas fa-building"></i> <%= scrape.floor %>. Kat</span>
              </div>
              <div class="item-location">
                <i class="fas fa-map-marker-alt"></i>
                <%= scrape.address %>
              </div>
              <div class="item-tracking">
                <span class="tracking-date">
                  <%= time_ago_in_words(scrape.created_at) %> önce eklendi
                </span>
                <span class="price-change positive">
                  <i class="fas fa-arrow-down"></i> Fiyat takibi başladı
                </span>
              </div>
            </div>
            <div class="item-actions">
              <%= link_to "Detaylar", property_path(scrape.property), class: "btn-details" %>
              <%= link_to "İlanı Gör", scrape.product_url, class: "btn-view-listing", target: "_blank" %>
            </div>
          </div>
        <% end %>

        <% if @total_pages > 1 %>
          <div class="pagination">
            <div class="pagination-info">
              Toplam <%= @total_count %> emlak, Sayfa <%= page %> / <%= @total_pages %>
            </div>
            <div class="pagination-links">
              <% if page > 1 %>
                <%= link_to "← Önceki", properties_path(page: page - 1), class: "pagination-link" %>
              <% end %>
              
              <% (1..@total_pages).each do |p| %>
                <% if p == page %>
                  <span class="pagination-link active"><%= p %></span>
                <% elsif (p - page).abs <= 2 || p == 1 || p == @total_pages %>
                  <%= link_to p, properties_path(page: p), class: "pagination-link" %>
                <% elsif (p == 2 && page > 4) || (p == @total_pages - 1 && page < @total_pages - 3) %>
                  <span class="pagination-ellipsis">...</span>
                <% end %>
              <% end %>
              
              <% if page < @total_pages %>
                <%= link_to "Sonraki →", properties_path(page: page + 1), class: "pagination-link" %>
              <% end %>
            </div>
          </div>
        <% end %>
      <% else %>
        <div class="no-items">
          <p>Henüz takip ettiğiniz emlak bulunmuyor.</p>
        </div>
      <% end %>
    </div>

    <div class="popup-overlay" data-popup-target="overlay" data-action="click->popup#closeIfOverlay">
      <div class="tracking-popup">
        <div class="popup-header">
          <h2>Yeni Emlak Takibi</h2>
          <p>Adım adım emlak takibi oluşturun</p>
        </div>

        <div class="popup-steps">
          <div class="step-indicator">
            <div class="step-dot active" data-popup-target="stepDot" data-step="1"></div>
            <div class="step-line"></div>
            <div class="step-dot" data-popup-target="stepDot" data-step="2"></div>
            <div class="step-line"></div>
            <div class="step-dot" data-popup-target="stepDot" data-step="3"></div>
            <div class="step-line"></div>
            <div class="step-dot" data-popup-target="stepDot" data-step="4"></div>
            <div class="step-line"></div>
            <div class="step-dot" data-popup-target="stepDot" data-step="5"></div>
          </div>
        </div>

        <div class="selection-summary" data-popup-target="summary" style="display: none;">
          <h4>Seçimleriniz</h4>
          <p class="website-selection"></p>
          <p class="city-selection"></p>
          <p class="type-selection"></p>
          <p class="category-selection"></p>
          <p class="room-selection"></p>
        </div>

        <div class="popup-content">
          <!-- Step 1: Website Selection -->
          <div class="step-content active" data-popup-target="stepContent" data-step="1">
            <div class="website-options">
              <div class="option-card multi-select" data-value="sahibinden" data-action="click->popup#handleMultiSelect">
                <%= image_tag "sahibindenfavicon.ico", alt: "Sahibinden.com" %>
                <span>Sahibinden.com</span>
              </div>
              <div class="option-card multi-select" data-value="hepsiemlak" data-action="click->popup#handleMultiSelect">
                <%= image_tag "hepsiemlakfavicon.ico", alt: "Hepsiemlak.com" %>
                <span>Hepsiemlak.com</span>
              </div>
              <div class="option-card multi-select" data-value="emlakjet" data-action="click->popup#handleMultiSelect">
                <%= image_tag "emlakjetfavicon.png", alt: "Emlakjet" %>
                <span>Emlakjet</span>
              </div>
              <div class="option-card multi-select" data-value="zingat" data-action="click->popup#handleMultiSelect">
                <%= image_tag "zingatfavicon.png", alt: "Zingat" %>
                <span>Zingat</span>
              </div>
            </div>
          </div>

          <!-- Step 2: City Selection -->
          <div class="step-content" data-popup-target="stepContent" data-step="2">
            <div class="city-options">
              <div class="option-card multi-select special-option" data-value="all" data-action="click->popup#handleMultiSelect">
                <i class="fas fa-globe-europe"></i>
                <span>Tüm Türkiye</span>
              </div>
              <div class="option-card multi-select" data-value="istanbul" data-action="click->popup#handleMultiSelect">
                <i class="fas fa-city"></i>
                <span>İstanbul</span>
              </div>
              <div class="option-card multi-select" data-value="ankara" data-action="click->popup#handleMultiSelect">
                <i class="fas fa-city"></i>
                <span>Ankara</span>
              </div>
              <div class="option-card multi-select" data-value="izmir" data-action="click->popup#handleMultiSelect">
                <i class="fas fa-city"></i>
                <span>İzmir</span>
              </div>
            </div>
          </div>

          <!-- Step 3: Property Type Selection -->
          <div class="step-content" data-popup-target="stepContent" data-step="3">
            <div class="type-options">
              <div class="option-card" data-value="konut" data-action="click->popup#handleSingleSelect">
                <i class="fas fa-home"></i>
                <span>Konut</span>
              </div>
              <div class="option-card" data-value="isyeri" data-action="click->popup#handleSingleSelect">
                <i class="fas fa-building"></i>
                <span>İş Yeri</span>
              </div>
              <div class="option-card" data-value="arsa" data-action="click->popup#handleSingleSelect">
                <i class="fas fa-map"></i>
                <span>Arsa</span>
              </div>
            </div>
          </div>

          <!-- Step 4: Category Selection -->
          <div class="step-content" data-popup-target="stepContent" data-step="4">
            <div class="category-options">
              <!-- Dinamik olarak doldurulacak -->
            </div>
          </div>

          <!-- Step 5: Room Selection -->
          <div class="step-content" data-popup-target="stepContent" data-step="5">
            <div class="room-options">
              <!-- Dinamik olarak doldurulacak -->
            </div>
          </div>
        </div>

        <div class="popup-actions">
          <button class="btn-prev" data-popup-target="prevButton" data-action="click->popup#prev" style="display: none;">Geri</button>
          <button class="btn-cancel" data-action="popup#close">İptal</button>
          <button class="btn-next" data-popup-target="nextButton" data-action="click->popup#next">Devam Et</button>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
/* Main Layout Styles */
.main-layout {
  display: flex;
  min-height: 100vh;
  background: #f8f9fa;
}

.no-items {
  text-align: center;
  padding: 2rem;
  background: white;
  border-radius: 1rem;
  box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}

.no-items p {
  color: #666;
  font-size: 1.1rem;
}

/* ... existing styles ... */

.option-card.multi-select {
  position: relative;
}

.option-card.multi-select::before {
  content: '';
  position: absolute;
  top: 10px;
  right: 10px;
  width: 20px;
  height: 20px;
  border: 2px solid #ddd;
  border-radius: 4px;
  transition: all 0.3s;
}

.option-card.multi-select.selected::before {
  background-color: #28a745;
  border-color: #28a745;
}

.option-card.multi-select.selected::after {
  content: '✓';
  position: absolute;
  top: 10px;
  right: 13px;
  color: white;
  font-size: 14px;
}

.option-card.special-option {
  grid-column: 1 / -1;
  background-color: #f8f9fa;
}

.option-card.special-option:hover {
  background-color: #e9ecef;
}

.website-options,
.city-options {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
  gap: 1rem;
}

/* Pagination Styles */
.pagination {
  margin-top: 2rem;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 1rem;
}

.pagination-info {
  color: #666;
  font-size: 0.9rem;
}

.pagination-links {
  display: flex;
  gap: 0.5rem;
  align-items: center;
  flex-wrap: wrap;
  justify-content: center;
}

.pagination-link {
  padding: 0.5rem 1rem;
  border: 1px solid #ddd;
  border-radius: 0.5rem;
  color: #007bff;
  text-decoration: none;
  transition: all 0.3s;
}

.pagination-link:hover {
  background: #007bff;
  color: white;
  border-color: #007bff;
}

.pagination-link.active {
  background: #007bff;
  color: white;
  border-color: #007bff;
}

.pagination-ellipsis {
  color: #666;
  padding: 0.5rem;
}

/* Responsive pagination */
@media (max-width: 768px) {
  .pagination-links {
    gap: 0.25rem;
  }
  
  .pagination-link {
    padding: 0.4rem 0.8rem;
    font-size: 0.9rem;
  }
}

/* Tracking Popup Styles */
.popup-overlay {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.5);
  z-index: 1000;
  justify-content: center;
  align-items: center;
}

.popup-overlay.active {
  display: flex !important;
}

.tracking-popup {
  background: white;
  border-radius: 1rem;
  padding: 2rem;
  width: 500px;
  max-width: 90%;
  max-height: 90vh;
  overflow-y: auto;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}
</style>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
