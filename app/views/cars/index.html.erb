<!-- Main Layout Container -->
<div class="main-layout">
  <!-- Navigation Sidebar -->
  <div class="nav-sidebar">
    <div class="logo">
      <img src="https://placehold.co/50x50" alt="Logo" />
      <span>Bulsam AI</span>
    </div>
    
    <nav class="nav-menu">
      <%= link_to dashboard_path, class: "nav-item #{current_page?(dashboard_path) ? 'active' : ''}" do %>
        <i class="fas fa-th-large"></i>
        <span>Dashboard</span>
      <% end %>
      
      <%= link_to cars_path, class: "nav-item #{controller_name == 'cars' ? 'active' : ''}" do %>
        <i class="fas fa-car"></i>
        <span>Araç Takibi</span>
      <% end %>
      
      <%= link_to properties_path, class: "nav-item #{controller_name == 'properties' ? 'active' : ''}" do %>
        <i class="fas fa-home"></i>
        <span>Emlak Takibi</span>
      <% end %>
      
      <%= link_to notifications_path, class: "nav-item #{controller_name == 'notifications' ? 'active' : ''}", data: { turbo: false } do %>
        <i class="fas fa-bell"></i>
        <span>Bildirimler</span>
      <% end %>
      
      <a href="#" class="nav-item">
        <i class="fas fa-cog"></i>
        <span>Ayarlar</span>
      </a>
    </nav>
  </div>

  <!-- Main Content Area -->
  <div class="main-content" data-controller="popup features">
    <div class="content-header">
      <div class="header-left">
        <h1>Araç Takibi</h1>
        <p>Takip ettiğiniz araçların listesi</p>
      </div>
      
      <div class="search-bar">
        <input type="text" placeholder="Araç ara..." />
        <button class="search-btn"><i class="fas fa-search"></i></button>
        <button class="filter-btn"><i class="fas fa-filter"></i></button>
        <button class="btn-add-tracking" data-action="click->popup#open">
          <i class="fas fa-plus"></i>
          Yeni Araç Takibi Ekle
        </button>
      </div>
    </div>

    <!-- Tracked Cars List -->
    <div class="tracked-items">
      <% if @car_trackings.any? %>
        <% @car_trackings.each do |tracking| %>
          <div class="tracked-item" data-controller="accordion" data-tracking-id="<%= tracking.id %>">
            <div class="item-main">
              <div class="item-details" data-action="click->accordion#toggle">
                <div class="item-header">
                  <h3>
                    <%= tracking.category.name %>
                    <%= "- #{tracking.brand.name}" if tracking.brand.present? %>
                    <%= "#{tracking.model.name}" if tracking.model.present? %>
                    <%= "#{tracking.serial.name}" if tracking.serial.present? %>
                    <% if tracking.car_tracking_feature.present? %>
                      <span class="active-filters-summary">
                        <% filters = [] %>
                        <% filters << "Renk: #{tracking.colors.join(', ')}" if tracking.colors.present? %>
                        <% if tracking.year_min.present? || tracking.year_max.present? %>
                          <% filters << "Yıl: #{tracking.year_min}-#{tracking.year_max}" %>
                        <% end %>
                        <% if tracking.kilometer_min.present? || tracking.kilometer_max.present? %>
                          <% filters << "KM: #{number_with_delimiter(tracking.kilometer_min)}-#{number_with_delimiter(tracking.kilometer_max)}" %>
                        <% end %>
                        <% if tracking.price_min.present? || tracking.price_max.present? %>
                          <% filters << "Fiyat: #{number_to_currency(tracking.price_min, unit: '₺', format: '%n %u', precision: 0)}-#{number_to_currency(tracking.price_max, unit: '₺', format: '%n %u', precision: 0)}" %>
                        <% end %>
                        <% if tracking.notification_frequency.present? %>
                          <% frequency_text = case tracking.notification_frequency
                             when '30m' then '30 Dakika'
                             when '1h' then '1 Saat'
                             when '5h' then '5 Saat'
                             when '12h' then '12 Saat'
                             when '1d' then '1 Gün'
                             when '3d' then '3 Gün'
                             when '1w' then '1 Hafta'
                             end %>
                          <% filters << "Bildirim: #{frequency_text}" %>
                        <% end %>
                        <% if filters.any? %>
                          <small>(Filtreler: <%= filters.join(' | ') %>)</small>
                        <% end %>
                      </span>
                    <% end %>
                  </h3>
                  <div class="expand-icon">
                    <i class="fas fa-chevron-down" data-accordion-target="icon"></i>
                  </div>
                </div>
                <div class="item-specs">
                  <span><i class="fas fa-globe"></i> <%= tracking.websites.join(', ') %></span>
                  <span><i class="fas fa-map-marker-alt"></i> <%= tracking.cities.include?('all') ? 'Tüm Türkiye' : tracking.cities.join(', ') %></span>
                </div>
                <div class="item-tracking">
                  <span class="tracking-date">
                    <%= time_ago_in_words(tracking.created_at) %> önce eklendi
                  </span>
                  <% if tracking.last_scrape_at.present? %>
                    <span class="tracking-stats">
                      <span class="last-run">
                        <i class="fas fa-clock"></i> Son tarama: <%= time_ago_in_words(tracking.last_scrape_at) if tracking.last_scrape_at.present? %> önce
                      </span>
                      <span class="scrape-count">
                        <i class="fas fa-sync"></i> Bugün <%= tracking.daily_scrape_count %> kez tarandı
                      </span>
                      <span class="total-scrapes">
                        <i class="fas fa-chart-line"></i> Toplam <%= tracking.total_scrape_count %> kez tarandı
                      </span>
                    </span>
                  <% end %>
                </div>
              </div>
              <div class="item-actions">
                <div class="action-buttons">
                  <%= button_to car_path(tracking), 
                      method: :delete, 
                      class: "btn-action btn-stop-tracking", 
                      data: { 
                        confirm: "Bu takibi silmek istediğinize emin misiniz?",
                        turbo: false
                      } do %>
                    <i class="fas fa-trash-alt"></i>
                    <span>Takibi Bırak</span>
                  <% end %>
                  
                  <button class="btn-action btn-add-features" data-action="click->features#open" data-tracking-id="<%= tracking.id %>">
                    <i class="fas fa-sliders-h"></i>
                    <span>Özellik Ekle</span>
                  </button>
                </div>
              </div>
            </div>
            
            <!-- Scrape Results Section -->
            <div class="scrape-results" data-accordion-target="content">
              <div class="scrape-results-header">
                <h4>Bulunan Araçlar</h4>
                <span class="last-update">Son güncelleme: <%= time_ago_in_words(tracking.car_scrapes.maximum(:created_at)) if tracking.car_scrapes.any? %> önce</span>
              </div>
              <div class="scrape-results-list">
                <div class="accordion-content" data-accordion-target="content">
                  <% tracking.recent_scrapes(params["scrape_page_#{tracking.id}"].to_i.zero? ? 1 : params["scrape_page_#{tracking.id}"].to_i).each do |scrape| %>
                    <div class="scraped-car <%= 'new-car' if scrape.is_new %>">
                      <div class="car-image">
                        <img src="<%= scrape.image_url %>" alt="<%= scrape.title %>">
                        <% if scrape.is_new %>
                          <div class="new-badge">Yeni!</div>
                        <% end %>
                      </div>
                      <div class="car-details">
                        <h5><%= scrape.title %></h5>
                        <div class="car-specs">
                          <span><i class="fas fa-tachometer-alt"></i> <%= number_with_delimiter(scrape.km) %> km</span>
                          <span><i class="fas fa-calendar"></i> <%= scrape.year %></span>
                          <span><i class="fas fa-palette"></i> <%= scrape.color %></span>
                          <span><i class="fas fa-map-marker-alt"></i> <%= scrape.city %></span>
                        </div>
                        <div class="car-dates">
                          <span class="listing-date">
                            <i class="fas fa-calendar-alt"></i> İlan Tarihi: <%= l(scrape.public_date, format: :long) %>
                          </span>
                          <span class="added-date">
                            <i class="fas fa-clock"></i> Eklenme: <%= time_ago_in_words(scrape.created_at) %> önce
                          </span>
                        </div>
                        <div class="car-price">
                          <span class="price"><%= number_to_currency(scrape.price, unit: "₺", format: "%n %u", delimiter: ".", precision: 0) %></span>
                          <a href="<%= scrape.product_url %>" class="btn-view" target="_blank">İlana Git <i class="fas fa-external-link-alt"></i></a>
                        </div>
                      </div>
                    </div>
                  <% end %>
                  
                  <% if tracking.filtered_scrapes.count > 5 %>
                    <div class="pagination">
                      <div class="pagination-info">
                        Toplam <%= tracking.filtered_scrapes.count %> sonuç, 
                        Sayfa <%= params["scrape_page_#{tracking.id}"] || 1 %> / <%= (tracking.filtered_scrapes.count.to_f / 5).ceil %>
                      </div>
                      <div class="pagination-links">
                        <% if (params["scrape_page_#{tracking.id}"].to_i || 1) > 1 %>
                          <%= link_to "← Önceki", 
                              cars_path(
                                "scrape_page_#{tracking.id}" => (params["scrape_page_#{tracking.id}"].to_i || 1) - 1,
                                open_accordion: tracking.id
                              ), 
                              class: "pagination-link",
                              data: { turbo_frame: "_top", tracking_scroll: tracking.id } %>
                        <% end %>
                        
                        <% total_pages = (tracking.filtered_scrapes.count.to_f / 5).ceil %>
                        <% current_page = (params["scrape_page_#{tracking.id}"].to_i || 1) %>
                        
                        <% (1..total_pages).each do |p| %>
                          <% if p <= 3 || p == total_pages || (p - current_page).abs <= 1 %>
                            <% if p == current_page %>
                              <span class="pagination-link active"><%= p %></span>
                            <% else %>
                              <%= link_to p, 
                                  cars_path(
                                    "scrape_page_#{tracking.id}" => p,
                                    open_accordion: tracking.id
                                  ), 
                                  class: "pagination-link",
                                  data: { turbo_frame: "_top", tracking_scroll: tracking.id } %>
                            <% end %>
                          <% elsif p == 4 && total_pages > 5 %>
                            <span class="pagination-ellipsis">...</span>
                          <% end %>
                        <% end %>
                        
                        <% if current_page < total_pages %>
                          <%= link_to "Sonraki →", 
                              cars_path(
                                "scrape_page_#{tracking.id}" => current_page + 1,
                                open_accordion: tracking.id
                              ), 
                              class: "pagination-link",
                              data: { turbo_frame: "_top", tracking_scroll: tracking.id } %>
                        <% end %>
                      </div>
                    </div>
                  <% end %>
                </div>
              </div>
            </div>
          </div>
        <% end %>

        <% if @car_trackings.total_pages > 1 %>
          <div class="pagination">
            <div class="pagination-info">
              Toplam <%= @car_trackings.total_count %> takip, 
              Sayfa <%= @car_trackings.current_page %> / <%= @car_trackings.total_pages %>
            </div>
            <%= paginate @car_trackings %>
          </div>
        <% end %>
      <% else %>
        <div class="no-items">
          <p>Henüz takip ettiğiniz araç bulunmuyor.</p>
        </div>
      <% end %>
    </div>

    <div class="popup-overlay" data-popup-target="overlay" data-action="click->popup#closeIfOverlay">
      <div class="tracking-popup">
        <div class="popup-header">
          <h2>Yeni Araç Takibi</h2>
          <p>Adım adım araç takibi oluşturun</p>
        </div>

        <div class="popup-steps">
          <div class="step-indicator">
            <div class="step-dot active" data-popup-target="stepDot" data-step="1"></div>
            <div class="step-line"></div>
            <div class="step-dot" data-popup-target="stepDot" data-step="2"></div>
            <div class="step-line"></div>
            <div class="step-dot" data-popup-target="stepDot" data-step="3"></div>
            <div class="step-line"></div>
            <div class="step-dot" data-popup-target="stepDot" data-step="4"></div>
            <div class="step-line"></div>
            <div class="step-dot" data-popup-target="stepDot" data-step="5"></div>
            <div class="step-line"></div>
            <div class="step-dot" data-popup-target="stepDot" data-step="6"></div>
          </div>
        </div>

        <div class="selection-summary" data-popup-target="summary" style="display: none;">
          <h4>Seçimleriniz</h4>
          <p class="website-selection"></p>
          <p class="city-selection"></p>
          <p class="type-selection"></p>
          <p class="brand-selection"></p>
          <p class="model-selection"></p>
          <p class="serial-selection"></p>
        </div>

        <div class="popup-content">
          <!-- Step 1: Website Selection -->
          <div class="step-content active" data-popup-target="stepContent" data-step="1">
            <div class="website-options">
              <div class="option-card multi-select" data-value="arabam" data-action="click->popup#handleMultiSelect">
                <%= image_tag "arabamfavicon.png", alt: "Arabam.com" %>
                <span>Arabam.com</span>
              </div>
              <div class="option-card multi-select" data-value="sahibinden" data-action="click->popup#handleMultiSelect">
                <%= image_tag "sahibindenfavicon.ico", alt: "Sahibinden.com" %>
                <span>Sahibinden.com</span>
              </div>
            </div>
          </div>

          <!-- Step 2: City Selection -->
          <div class="step-content" data-popup-target="stepContent" data-step="2">
            <div class="city-options">
              <div class="option-card multi-select special-option" data-value="all" data-action="click->popup#handleMultiSelect">
                <i class="fas fa-globe-europe"></i>
                <span>Tüm Türkiye</span>
              </div>
              <div class="option-card multi-select" data-value="istanbul" data-action="click->popup#handleMultiSelect">
                <i class="fas fa-city"></i>
                <span>İstanbul</span>
              </div>
              <div class="option-card multi-select" data-value="ankara" data-action="click->popup#handleMultiSelect">
                <i class="fas fa-city"></i>
                <span>Ankara</span>
              </div>
              <div class="option-card multi-select" data-value="izmir" data-action="click->popup#handleMultiSelect">
                <i class="fas fa-city"></i>
                <span>İzmir</span>
              </div>
            </div>
          </div>

          <!-- Step 3: Vehicle Type Selection -->
          <div class="step-content" data-popup-target="stepContent" data-step="3">
            <div class="type-options">
              <% Category.where(company_id: 1).each do |category| %>
                <div class="option-card" data-value="<%= category.id %>" data-action="click->popup#handleSingleSelect">
                  <i class="fas fa-car"></i>
                  <span><%= category.name %></span>
                </div>
              <% end %>
            </div>
          </div>

          <!-- Step 4: Brand Selection -->
          <div class="step-content" data-popup-target="stepContent" data-step="4">
            <div class="brand-options">
              <!-- Dinamik olarak doldurulacak -->
            </div>
          </div>

          <!-- Step 5: Model Selection -->
          <div class="step-content" data-popup-target="stepContent" data-step="5">
            <div class="model-options">
              <!-- Dinamik olarak doldurulacak -->
            </div>
          </div>

          <!-- Step 6: Serial Selection -->
          <div class="step-content" data-popup-target="stepContent" data-step="6">
            <div class="serial-options">
              <!-- Dinamik olarak doldurulacak -->
            </div>
          </div>

          <div class="feature-group">
            <h4>Bildirim Sıklığı</h4>
            <div class="frequency-options">
              <label class="frequency-option">
                <input type="radio" name="notification_frequency" value="30m">
                <span class="frequency-name">30 Dakika</span>
              </label>
              <label class="frequency-option">
                <input type="radio" name="notification_frequency" value="1h">
                <span class="frequency-name">1 Saat</span>
              </label>
              <label class="frequency-option">
                <input type="radio" name="notification_frequency" value="2h">
                <span class="frequency-name">2 Saat</span>
              </label>
              <label class="frequency-option">
                <input type="radio" name="notification_frequency" value="5h">
                <span class="frequency-name">5 Saat</span>
              </label>
              <label class="frequency-option">
                <input type="radio" name="notification_frequency" value="12h">
                <span class="frequency-name">12 Saat</span>
              </label>
              <label class="frequency-option">
                <input type="radio" name="notification_frequency" value="1d">
                <span class="frequency-name">1 Gün</span>
              </label>
              <label class="frequency-option">
                <input type="radio" name="notification_frequency" value="3d">
                <span class="frequency-name">3 Gün</span>
              </label>
              <label class="frequency-option">
                <input type="radio" name="notification_frequency" value="1w">
                <span class="frequency-name">1 Hafta</span>
              </label>
            </div>
          </div>

          <div class="feature-actions">
            <button class="btn-cancel" data-action="click->features#close">İptal</button>
            <button class="btn-save" data-action="click->features#save">Kaydet</button>
          </div>
        </div>

        <div class="popup-actions">
          <button class="btn-prev" data-popup-target="prevButton" data-action="click->popup#prev" style="display: none;">Geri</button>
          <div>
            <button class="btn-cancel" data-action="popup#close">İptal</button>
            <button class="btn-track" data-popup-target="trackButton" data-action="click->popup#track">Takip Et</button>
            <button class="btn-next" data-popup-target="nextButton" data-action="click->popup#next">Devam Et</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Features Popup -->
    <div class="features-popup" data-features-target="popup" data-action="click->features#closeIfOverlay">
      <div class="popup-content">
        <div class="popup-header">
          <h3>Takip Özellikleri</h3>
          <button class="close-button" data-action="click->features#close">&times;</button>
        </div>
        <div class="popup-body" data-features-target="form">
          <input type="hidden" data-features-target="trackingId">
          <div class="feature-group">
            <h4>Renk</h4>
            <div class="color-options">
              <label class="color-option">
                <input type="checkbox" name="colors[]" value="Tüm Renkler">
                <span class="color-name">Tüm Renkler</span>
              </label>
              <% %w[Beyaz Siyah Gri Gümüş Kırmızı Mavi Yeşil Kahverengi Bej].each do |color| %>
                <label class="color-option">
                  <input type="checkbox" name="colors[]" value="<%= color %>">
                  <span class="color-name"><%= color %></span>
                </label>
              <% end %>
            </div>
          </div>

          <div class="feature-group">
            <h4>Yıl</h4>
            <div class="range-inputs">
              <div class="input-group">
                <input type="number" name="year_min" placeholder="Min yıl" min="1900" max="<%= Time.current.year %>" class="year-input">
                <span class="unit">yıl</span>
              </div>
              <div class="input-group">
                <input type="number" name="year_max" placeholder="Max yıl" min="1900" max="<%= Time.current.year %>" class="year-input">
                <span class="unit">yıl</span>
              </div>
            </div>
          </div>

          <div class="feature-group">
            <h4>Kilometre</h4>
            <div class="range-inputs">
              <div class="input-group">
                <input type="number" name="kilometer_min" placeholder="Min km" min="0" step="1000">
                <span class="unit">km</span>
              </div>
              <div class="input-group">
                <input type="number" name="kilometer_max" placeholder="Max km" min="0" step="1000">
                <span class="unit">km</span>
              </div>
            </div>
          </div>

          <div class="feature-group">
            <h4>Fiyat</h4>
            <div class="range-inputs">
              <div class="input-group">
                <input type="number" name="price_min" placeholder="Min fiyat" min="0" step="1000">
                <span class="unit">₺</span>
              </div>
              <div class="input-group">
                <input type="number" name="price_max" placeholder="Max fiyat" min="0" step="1000">
                <span class="unit">₺</span>
              </div>
            </div>
          </div>

          <div class="feature-group">
            <h4>Bildirim Sıklığı</h4>
            <div class="frequency-options">
              <label class="frequency-option">
                <input type="radio" name="notification_frequency" value="30m">
                <span class="frequency-name">30 Dakika</span>
              </label>
              <label class="frequency-option">
                <input type="radio" name="notification_frequency" value="1h">
                <span class="frequency-name">1 Saat</span>
              </label>
              <label class="frequency-option">
                <input type="radio" name="notification_frequency" value="2h">
                <span class="frequency-name">2 Saat</span>
              </label>
              <label class="frequency-option">
                <input type="radio" name="notification_frequency" value="5h">
                <span class="frequency-name">5 Saat</span>
              </label>
              <label class="frequency-option">
                <input type="radio" name="notification_frequency" value="12h">
                <span class="frequency-name">12 Saat</span>
              </label>
              <label class="frequency-option">
                <input type="radio" name="notification_frequency" value="1d">
                <span class="frequency-name">1 Gün</span>
              </label>
              <label class="frequency-option">
                <input type="radio" name="notification_frequency" value="3d">
                <span class="frequency-name">3 Gün</span>
              </label>
              <label class="frequency-option">
                <input type="radio" name="notification_frequency" value="1w">
                <span class="frequency-name">1 Hafta</span>
              </label>
            </div>
          </div>

          <div class="feature-actions">
            <button class="btn-cancel" data-action="click->features#close">İptal</button>
            <button class="btn-save" data-action="click->features#save">Kaydet</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
/* Main Layout Styles */
.main-layout {
  display: flex;
  min-height: 100vh;
  background: #f8f9fa;
}

/* Navigation Sidebar */
.nav-sidebar {
  width: 250px;
  background: #114856;
  color: white;
  padding: 1.5rem;
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
}

.logo {
  display: flex;
  align-items: center;
  gap: 1rem;
  padding: 0.5rem;
  font-size: 1.2rem;
  font-weight: bold;
}

.logo img {
  width: 40px;
  height: 40px;
  border-radius: 8px;
}

.nav-menu {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.nav-item {
  display: flex;
  align-items: center;
  gap: 1rem;
  padding: 0.75rem 1rem;
  color: #a0a0a0;
  text-decoration: none;
  border-radius: 0.5rem;
  transition: all 0.3s;
}

.nav-item:hover {
  background: rgba(255, 255, 255, 0.1);
  color: white;
}

.nav-item.active {
  background: rgba(255, 255, 255, 0.1);
  color: white;
}

/* Main Content Area */
.main-content {
  flex: 1;
  padding: 2rem;
  overflow-y: auto;
}

.content-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 2rem;
}

.header-left h1 {
  font-size: 1.8rem;
  margin-bottom: 0.5rem;
  color: #333;
}

.header-left p {
  color: #666;
}

.search-bar {
  display: flex;
  gap: 0.5rem;
  align-items: center;
}

.search-bar input {
  padding: 0.5rem 1rem;
  border: 1px solid #ddd;
  border-radius: 0.5rem;
  width: 300px;
}

.search-btn, .filter-btn {
  padding: 0.5rem 1rem;
  border: none;
  border-radius: 0.5rem;
  background: #007bff;
  color: white;
  cursor: pointer;
  transition: background 0.3s;
}

.search-btn:hover, .filter-btn:hover {
  background: #0056b3;
}

.btn-add-tracking {
  padding: 0.5rem 1rem;
  background: #28a745;
  color: white;
  border: none;
  border-radius: 0.5rem;
  font-size: 1rem;
  cursor: pointer;
  transition: background 0.3s;
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
}

.btn-add-tracking:hover {
  background: #218838;
}

/* Tracked Items */
.tracked-items {
  display: grid;
  gap: 1.5rem;
}

.tracked-item {
  background: white;
  border-radius: 1rem;
  overflow: hidden;
  box-shadow: 0 2px 4px rgba(0,0,0,0.05);
  display: flex;
  gap: 1.5rem;
  padding: 1.5rem;
}

.item-image {
  width: 200px;
  height: 150px;
  flex-shrink: 0;
}

.item-image img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  border-radius: 0.5rem;
}

.item-details {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.item-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
}

.item-header h3 {
  font-size: 1.2rem;
  color: #333;
  margin: 0;
}

.price {
  font-size: 1.4rem;
  font-weight: bold;
  color: #28a745;
}

.item-specs {
  display: flex;
  gap: 1.5rem;
}

.item-specs span {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  color: #666;
}

.item-specs i {
  color: #007bff;
}

.item-location {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  color: #666;
}

.item-location i {
  color: #dc3545;
}

.item-tracking {
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  gap: 0.5rem;
}

.item-actions {
  display: flex;
  gap: 1rem;
  align-items: flex-start;
}

.btn-view-listing {
  padding: 0.75rem 1.5rem;
  background: #007bff;
  color: white;
  text-decoration: none;
  border-radius: 0.5rem;
  transition: background 0.3s;
}

.btn-view-listing:hover {
  background: #0056b3;
}

.no-items {
  text-align: center;
  padding: 3rem;
  background: white;
  border-radius: 1rem;
  box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}

.no-items p {
  color: #666;
  font-size: 1.1rem;
}

/* Responsive Design */
@media (max-width: 1024px) {
  .main-layout {
    flex-direction: column;
  }
  
  .nav-sidebar {
    width: 100%;
    padding: 1rem;
  }
  
  .tracked-item {
    flex-direction: column;
  }
  
  .item-image {
    width: 100%;
    height: 200px;
  }
  
  .search-bar {
    flex-wrap: wrap;
  }
  
  .search-bar input {
    width: 100%;
    margin-bottom: 0.5rem;
  }
  
  .btn-add-tracking {
    width: 100%;
    justify-content: center;
    margin-top: 0.5rem;
  }
}

/* Pagination Styles */
.pagination {
  margin-top: 2rem;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 1rem;
}

.pagination-info {
  color: #666;
  font-size: 0.9rem;
}

.pagination-links {
  display: flex;
  gap: 0.5rem;
  align-items: center;
  flex-wrap: wrap;
  justify-content: center;
}

.pagination-link {
  padding: 0.5rem 1rem;
  border: 1px solid #ddd;
  border-radius: 0.5rem;
  color: #007bff;
  text-decoration: none;
  transition: all 0.3s;
}

.pagination-link:hover {
  background: #007bff;
  color: white;
  border-color: #007bff;
}

.pagination-link.active {
  background: #007bff;
  color: white;
  border-color: #007bff;
}

.pagination-ellipsis {
  color: #666;
  padding: 0.5rem;
}

/* Responsive pagination */
@media (max-width: 768px) {
  .pagination-links {
    gap: 0.25rem;
  }
  
  .pagination-link {
    padding: 0.4rem 0.8rem;
    font-size: 0.9rem;
  }
}

/* Tracking Popup Styles */
.popup-overlay {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.5);
  z-index: 1000;
  justify-content: center;
  align-items: center;
}

.popup-overlay.active {
  display: flex !important;
}

.tracking-popup {
  background: white;
  border-radius: 1rem;
  padding: 2rem;
  width: 500px;
  max-width: 90%;
  max-height: 90vh;
  overflow-y: auto;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.popup-header {
  text-align: center;
  margin-bottom: 1.5rem;
}

.popup-header h2 {
  font-size: 1.5rem;
  color: #333;
  margin-bottom: 0.5rem;
}

.popup-header p {
  color: #666;
  font-size: 0.9rem;
}

.popup-steps {
  display: flex;
  justify-content: center;
  margin-bottom: 1.5rem;
}

.step-indicator {
  display: flex;
  align-items: center;
}

.step-dot {
  width: 10px;
  height: 10px;
  border-radius: 50%;
  background: #ddd;
  margin: 0 4px;
}

.step-dot.active {
  background: #28a745;
}

.step-line {
  width: 30px;
  height: 2px;
  background: #ddd;
  margin: 0 4px;
}

.popup-content {
  margin-bottom: 1.5rem;
}

.popup-content > div {
  display: none;
}

.popup-content > div.active {
  display: block;
}

.selection-summary {
  background: #f8f9fa;
  border-radius: 0.5rem;
  padding: 1rem;
  margin-bottom: 1.5rem;
  font-size: 0.9rem;
}

.selection-summary h4 {
  color: #333;
  margin-bottom: 0.5rem;
}

.selection-summary p {
  color: #666;
  margin: 0.25rem 0;
}

.website-options,
.city-options,
.type-options,
.brand-options,
.model-options {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 1rem;
}

.option-card {
  border: 1px solid #ddd;
  border-radius: 0.5rem;
  padding: 1rem;
  cursor: pointer;
  transition: all 0.3s;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.option-card:hover {
  border-color: #28a745;
  background: #f8f9fa;
}

.option-card.selected {
  border-color: #28a745;
  background: #e8f5e9;
}

.option-card img {
  width: 24px;
  height: 24px;
  object-fit: contain;
}

.popup-actions {
  display: flex;
  justify-content: space-between;
  gap: 1rem;
}

.btn-prev,
.btn-next,
.btn-cancel {
  padding: 0.75rem 1.5rem;
  border-radius: 0.5rem;
  border: none;
  font-size: 1rem;
  cursor: pointer;
  transition: background 0.3s;
}

.btn-prev {
  background: #f8f9fa;
  color: #333;
}

.btn-prev:hover {
  background: #e9ecef;
}

.btn-next {
  background: #28a745;
  color: white;
}

.btn-next:hover {
  background: #218838;
}

.btn-cancel {
  background: #dc3545;
  color: white;
}

.btn-cancel:hover {
  background: #c82333;
}

.option-card.multi-select {
  position: relative;
}

.option-card.multi-select::before {
  content: '';
  position: absolute;
  top: 10px;
  right: 10px;
  width: 20px;
  height: 20px;
  border: 2px solid #ddd;
  border-radius: 4px;
  transition: all 0.3s;
}

.option-card.multi-select.selected::before {
  background-color: #28a745;
  border-color: #28a745;
}

.option-card.multi-select.selected::after {
  content: '✓';
  position: absolute;
  top: 10px;
  right: 13px;
  color: white;
  font-size: 14px;
}

.option-card.special-option {
  grid-column: 1 / -1;
  background-color: #f8f9fa;
}

.option-card.special-option:hover {
  background-color: #e9ecef;
}

.website-options,
.city-options {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
  gap: 1rem;
}

.btn-track {
  padding: 0.75rem 1.5rem;
  border-radius: 0.5rem;
  border: none;
  font-size: 1rem;
  cursor: pointer;
  transition: all 0.3s;
  background: #007bff;
  color: white;
  margin-right: 0.5rem;
  visibility: hidden;
  opacity: 0;
  transition: visibility 0s, opacity 0.3s linear;
}

.btn-track:hover {
  background: #0056b3;
}

.popup-actions {
  display: flex;
  justify-content: space-between;
  gap: 1rem;
}

.popup-actions > div {
  display: flex;
  gap: 0.5rem;
}

/* Action Buttons */
.action-buttons {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
  min-width: 150px;
}

.btn-action {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
  padding: 0.75rem 1rem;
  border: none;
  border-radius: 0.5rem;
  font-size: 0.9rem;
  cursor: pointer;
  transition: all 0.3s;
  width: 100%;
  text-align: center;
}

.btn-stop-tracking {
  background: #dc3545;
  color: white;
}

.btn-stop-tracking:hover {
  background: #c82333;
}

.btn-add-features {
  background: #6c757d;
  color: white;
}

.btn-add-features:hover {
  background: #5a6268;
}

/* Features Popup Styles */
.features-popup {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.5);
  z-index: 1000;
  justify-content: center;
  align-items: center;
}

.features-popup.active {
  display: flex;
}

.popup-content {
  background: white;
  border-radius: 1rem;
  padding: 2rem;
  width: 500px;
  max-width: 90%;
  max-height: 90vh;
  overflow-y: auto;
}

.popup-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1.5rem;
}

.popup-header h3 {
  margin: 0;
  font-size: 1.5rem;
  color: #333;
}

.close-button {
  background: none;
  border: none;
  font-size: 1.5rem;
  color: #666;
  cursor: pointer;
}

.popup-body {
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
}

.feature-group {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.feature-group h4 {
  margin: 0;
  font-size: 1.1rem;
  color: #333;
}

.color-options {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
  gap: 0.75rem;
}

.color-option {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.5rem;
  border: 1px solid #ddd;
  border-radius: 0.5rem;
  cursor: pointer;
  transition: all 0.2s;
}

.color-option:hover {
  background: #f8f9fa;
}

.color-option input[type="checkbox"] {
  width: 16px;
  height: 16px;
}

.range-inputs {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1rem;
}

.input-group {
  position: relative;
}

.input-group input {
  width: 100%;
  padding: 0.5rem;
  padding-right: 2.5rem;
  border: 1px solid #ddd;
  border-radius: 0.5rem;
  font-size: 1rem;
}

.input-group .unit {
  position: absolute;
  right: 0.75rem;
  top: 50%;
  transform: translateY(-50%);
  color: #666;
}

.feature-actions {
  display: flex;
  justify-content: flex-end;
  gap: 1rem;
  margin-top: 1rem;
}

.btn-save {
  padding: 0.5rem 1.5rem;
  background: #28a745;
  color: white;
  border: none;
  border-radius: 0.5rem;
  cursor: pointer;
  transition: background 0.2s;
}

.btn-save:hover {
  background: #218838;
}

.btn-cancel {
  padding: 0.5rem 1.5rem;
  background: #6c757d;
  color: white;
  border: none;
  border-radius: 0.5rem;
  cursor: pointer;
  transition: background 0.2s;
}

.btn-cancel:hover {
  background: #5a6268;
}

/* Active Filters Display */
.active-filters {
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
  margin-top: 1rem;
}

.filter-tag {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.25rem 0.75rem;
  background: #e9ecef;
  border-radius: 1rem;
  font-size: 0.9rem;
  color: #495057;
}

.filter-tag .remove {
  cursor: pointer;
  color: #dc3545;
}

.year-input {
  width: 100% !important;
  padding: 0.75rem !important;
  font-size: 1rem !important;
}

.range-inputs {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1rem;
  width: 100%;
}

.input-group {
  width: 100%;
}

.input-group input {
  width: 100%;
  padding: 0.75rem;
  padding-right: 3rem;
  border: 1px solid #ddd;
  border-radius: 0.5rem;
  font-size: 1rem;
}

.new-car {
  position: relative;
  border: 2px solid #28a745;
  border-radius: 0.5rem;
  box-shadow: 0 0 10px rgba(40, 167, 69, 0.2);
}

.new-badge {
  position: absolute;
  top: 10px;
  right: 10px;
  background: #28a745;
  color: white;
  padding: 0.25rem 0.75rem;
  border-radius: 1rem;
  font-size: 0.8rem;
  font-weight: bold;
  z-index: 1;
}

.active-filters-summary {
  font-size: 0.8rem;
  color: #6c757d;
  margin-left: 0.75rem;
  font-weight: normal;
}

.active-filters-summary small {
  background-color: #f8f9fa;
  padding: 0.25rem 0.5rem;
  border-radius: 0.25rem;
  white-space: nowrap;
  display: inline-block;
  margin-top: 0.25rem;
}

.frequency-options {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
  gap: 0.75rem;
}

.frequency-option {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.75rem;
  border: 1px solid #ddd;
  border-radius: 0.5rem;
  cursor: pointer;
  transition: all 0.2s;
}

.frequency-option:hover {
  background: #f8f9fa;
}

.frequency-option input[type="radio"] {
  width: 16px;
  height: 16px;
}

.frequency-option input[type="radio"]:checked + .frequency-name {
  color: #28a745;
  font-weight: bold;
}

.frequency-name {
  font-size: 0.9rem;
  color: #495057;
}

.tracking-stats {
  display: flex;
  flex-direction: row;
  gap: 1rem;
  margin-top: 0.5rem;
  font-size: 0.9rem;
  color: #6c757d;
  align-items: center;
}

.tracking-stats i {
  margin-right: 0.25rem;
  color: #28a745;
}

.last-run, .scrape-count, .total-scrapes {
  display: inline-flex;
  align-items: center;
  padding: 0.25rem 0.5rem;
  background: #f8f9fa;
  border-radius: 0.25rem;
}
</style>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

<script>
document.addEventListener('turbo:load', function() {
  const urlParams = new URLSearchParams(window.location.search);
  const trackingId = urlParams.get('open_accordion');
  
  if (trackingId) {
    const trackingElement = document.querySelector(`[data-tracking-id="${trackingId}"]`);
    if (trackingElement) {
      trackingElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }
  }
});
</script>
